---
- name: Create backup directory
  file:
    path: /srv/backup
    state: directory
    mode: 0755
- name: Create archive directory
  file:
    path: /srv/duplicity-archive
    state: directory
    mode: 0700
- name: Install duplicity
  apt:
    name: duplicity
    state: present
- name: Copy backup script
  copy:
    src: files/backup.sh
    dest: /root/backup.sh
    mode: 0700
- name: Schedule backups
  cron:
    name: backup
    user: root
    hour: 4
    minute: 0
    job: /root/backup.sh
